# カレンダーUI リファクタリング実装計画書 (Google Calendar風)

## 概要
カレンダーページ (`/calendar`) を Google Calendar のような高機能なUI/UXに刷新します。
`react-big-calendar` を導入し、月/週/日ごとのビュー切り替え、時間軸でのドラッグ&ドロップ編集を実現します。

## 現状の課題
- `react-day-picker` を使用した月表示のみで、1日の時間割（タイムライン）が視覚的に把握できない。
- タスクデータに「時刻」の情報を持たせるためのデータ構造が不足している（`executionDate` は `DATE` 型）。
- ドラッグ&ドロップ機能が限定的（日付変更のみ）。

---

## 実装フェーズ

### Phase 1: データ構造の拡張 (Backend)
Google Calendarのような時間管理を実現するため、タスクに時刻情報を持たせます。

- [ ] **Flywayマイグレーション**
  - `start_datetime` (DATETIME / TIMESTAMP) カラム追加
  - `end_datetime` (DATETIME / TIMESTAMP) カラム追加
  - または既存の `execution_date` に加えて `start_time` (TIME), `end_time` (TIME) を追加する案もあるが、日付をまたぐイベントを考慮すると `DATETIME` が望ましい。
  - **推奨案**:
    - `scheduled_start_at`: DATETIME
    - `scheduled_end_at`: DATETIME
    - `is_all_day`: BOOLEAN (終日フラグ)
- [ ] **Entity & DTO 更新**
  - Java: `Task` Entity, `TaskDto` 更新
  - TypeScript: `Task` 型定義更新 (`types.tsx`)

### Phase 2: フロントエンド基盤構築 (Frontend Library)
カレンダーライブラリを導入し、基本的な表示を整えます。

- [ ] **ライブラリ導入**
  - `react-big-calendar`: メインカレンダーコンポーネント
  - `@types/react-big-calendar`: 型定義
  - `moment` または `date-fns` アダプター設定
- [ ] **レイアウト構築**
  - **サイドバー**: ミニカレンダー（現状の `react-day-picker` を流用）、マイカレンダー（フィルタ）
  - **ヘッダー**: ビュー切り替えボタン (Month / Week / Day)、Todayボタン、前後移動
  - **メインエリア**: `Calendar` コンポーネント配置

### Phase 3: ビュー実装 & データ連携
タスクデータをカレンダーイベント形式に変換し、表示します。

- [ ] **データマッピング**
  - `Task` → `CalendarEvent` 変換
  - `is_all_day` が true の場合は上部の「終日」枠に表示
  - 時間指定がある場合は該当する時間枠にブロック表示
- [ ] **スタイリング**
  - Google Calendar風のクリーンなデザインにCSSカスタマイズ
  - 祝日表示（オプション）

### Phase 4: インタラクション (Drag & Drop, Resize)
ユーザー操作によるタスク編集を実現します。

- [ ] **イベント操作**
  - **ドラッグ&ドロップ**: 開始時刻/日付の変更
  - **リサイズ**: 所要時間（終了時刻）の変更
  - **クリック**: `TaskDetailPanel` を開く
- [ ] **新規作成**
  - 空きスロットのクリック/ドラッグで新規タスク作成モーダルを開く
  - デフォルトで選択範囲の開始/終了時刻を入力済み状態にする

---

## 画面構成イメージ

```
┌─────────────────┬──────────────────────────────────────────────┐
│ [Mini Calendar] │ [Today] [<] [>]  2026年 1月      [周] [月] ▼ │
│                 ├──────────────────────────────────────────────┤
│ ┌ My Tasks      │  日     月     火     水     木     金     土  │
│ ☑ Work          │ ┌──┐                                         │
│ ☑ Personal      │ │12│ Allday Event...                         │
│                 │ └──┴───────┬───────┬───────┬───────┬───────┤
│                 │      9:00  │Task A │       │       │       │
│                 │            │(1h)   │       │       │       │
│                 │     10:00  └───────┘       │       │       │
│                 │                            │Task B │       │
│                 │     11:00                  │(2h)   │       │
│                 │                            │       │       │
│                 │     12:00                  │       │       │
│                 │                            └───────┘       │
└─────────────────┴──────────────────────────────────────────────┘
```

## 技術選定理由: react-big-calendar
- **柔軟性**: Reactコンポーネントとして完全に制御可能。
- **軽量**: FullCalendarほど機能過多ではなく、バンドルサイズを抑えられる。
- **実績**: Reactエコシステムでの標準的な選択肢の一つ。
- **DnD**: `react-big-calendar` はアドオンでDnDをサポートしている。

## 次のアクション
まず **Phase 1 (Backend)** から着手し、時刻データを保持できるようにする必要があります。
ユーザーの承認が得られれば、マイグレーションスクリプトの作成から開始します。
